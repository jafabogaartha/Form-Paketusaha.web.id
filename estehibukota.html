<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kemitraan Esteh Ibukota</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
:root {
    --primary-color: #5B21B6;    /* Deep purple */
    --secondary-color: #ffffff;   /* White background */
    --accent-color: #8B5CF6;     /* Bright purple */
    --text-color: #1F2937;       /* Dark gray for text */
    --text-light: #6B7280;       /* Light gray for secondary text */
    --white: #ffffff;
    --error: #EF4444;
    --success: #10B981;
    --border-radius: 12px;
}

body {
    background-color: #F3F4F6;
    min-height: 100vh;
    padding: 20px;
}

.container {
    width: 100%;
    max-width: 600px;
    margin: 20px auto;
    background: var(--white);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    border-radius: var(--border-radius);
    overflow: hidden;
}

.form-section {
    padding: 30px 20px;
}

.form-section h1 {
    color: var(--primary-color);
    font-size: 24px;
    font-weight: 700;
    text-align: center;
    margin-bottom: 30px;
    padding-bottom: 10px;
    border-bottom: 3px solid var(--accent-color);
}

.welcome-section {
    background: var(--white);
    padding: 20px;
    border: 2px solid var(--accent-color);
    border-radius: var(--border-radius);
    margin-bottom: 30px;
}

.welcome-section p {
    color: var(--text-color);
    font-size: 16px;
    line-height: 1.6;
    margin-bottom: 10px;
    text-align: center;
}

.welcome-section .hashtag {
    color: var(--primary-color);
    font-size: 18px;
    font-weight: 700;
    display: block;
    text-align: center;
    margin-top: 15px;
    padding: 10px;
    background-color: #F5F3FF;
    border-radius: var(--border-radius);
}

.form-input {
    margin-bottom: 20px;
}

.form-input label {
    display: block;
    color: var(--text-color);
    font-weight: 600;
    margin-bottom: 8px;
    font-size: 16px;
}

.form-input input,
.form-input select {
    width: 100%;
    padding: 12px;
    border: 2px solid #E5E7EB;
    border-radius: 8px;
    font-size: 16px;
    background-color: var(--white);
}

.form-input input:focus,
.form-input select:focus {
    border-color: var(--accent-color);
    outline: none;
    box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
}

.dana-options {
    display: grid;
    grid-template-columns: 1fr;
    gap: 10px;
    margin-bottom: 20px;
}

.dana-option {
    padding: 15px;
    border: 2px solid #E5E7EB;
    border-radius: 8px;
    text-align: center;
    cursor: pointer;
    background: var(--white);
    color: var(--text-color);
    font-weight: 500;
    transition: all 0.3s ease;
}

.dana-option:hover {
    border-color: var(--accent-color);
    background-color: #F5F3FF;
}

.dana-option.selected {
    background-color: var(--primary-color);
    color: var(--white);
    border-color: var(--primary-color);
}

.consultation-message {
    background-color: #F5F3FF;
    padding: 20px;
    border-radius: var(--border-radius);
    margin: 20px 0;
    text-align: center;
}

.consultation-message p {
    color: var(--text-color);
    margin-bottom: 10px;
}

.consultation-message .highlight {
    color: var(--primary-color);
    font-weight: 700;
    font-size: 16px;
    display: block;
    margin-top: 10px;
}

.submit-btn {
    width: 100%;
    padding: 15px;
    background-color: var(--primary-color);
    color: var(--white);
    border: none;
    border-radius: 8px;
    font-weight: 600;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.submit-btn:hover {
    background-color: var(--accent-color);
}

/* Responsive Improvements */
@media screen and (max-width: 768px) {
    body {
        padding: 0;
        margin: 0;
        min-height: 100vh;
        background-color: var(--white);
    }

    .container {
        width: 100%;
        max-width: 100%;
        margin: 0;
        padding: 0;
        border-radius: 0;
        box-shadow: none;
        border: none;
    }

    .form-section {
        padding: 20px;
    }

    .form-section h1 {
        font-size: 28px;
    }

    .dana-options {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media screen and (max-width: 480px) {
    body {
        padding: 10px;
    }

    .container {
        margin: 0;
        border-radius: 0;
    }

    .form-section {
        padding: 20px 15px;
    }

    .form-section h1 {
        font-size: 20px;
    }

    .welcome-section,
    .consultation-message {
        padding: 15px;
    }

    .form-input label {
        font-size: 14px;
    }

    .form-input input,
    .form-input select,
    .submit-btn {
        padding: 10px;
        font-size: 14px;
    }
}
/* Tablet and Desktop styles */
@media screen and (min-width: 769px) {
    body {
        padding: 20px;
        background-color: #F3F4F6;
    }

    .container {
        max-width: 600px;
        margin: 20px auto;
        border-radius: var(--border-radius);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .form-section {
        padding: 40px;
    }

}
    </style>
</head>

<body>
    <div class="container">
        <div class="form-section">
            <h1>Form Kemitraan Esteh Ibukota</h1>
                        <div class="welcome-section">
                <p>Hallo Calon Mitra.</p>
                <p>Ini adalah form pendaftaran untuk gabung jadi mitra kami.</p>
                <p>Kami siap bantu wujudkan bisnis untuk anda.</p>
                <p>Yuuk Kita Usahakan Sukses Itu.!</p>
                <p class="hashtag">#2025PunyaUsaha</p>
            </div>
            <form name="form-kontak" id="partnership-form">
                <div class="form-input">
                    <div class="form-input" style="display:none;">
                        <label for="Nama Usaha">Nama Usaha</label>
                        <input type="text" id="Nama Usaha" name="Nama Usaha" value="Esteh Ibukota" required
                            placeholder="Masukkan nama lengkap">
                    </div>

                    <div class="form-input">
                        <label for="nama">Nama Lengkap</label>
                        <input type="text" id="nama" name="nama" required placeholder="Masukkan nama lengkap">
                    </div>
                    <div class="form-input">
                        <label for="Alamat">Alamat</label>
                        <input type="text" id="Alamat" name="Alamat" required placeholder="Masukkan Alamat">
                    </div>
                    <div class="form-input">
                        <label for="pekerjaan">Pekerjaan</label>
                        <input type="text" id="pekerjaan" name="pekerjaan" required placeholder="Masukkan pekerjaan">
                    </div>
                    <div class="form-input">
                        <label for="Usia">Usia</label>
                        <input type="number" id="Usia" name="Usia" required min="0" max="120"
                            placeholder="Masukkan Usia Anda" data-tahun="Tahun">
                    </div>
                    <div class="form-input">
                        <label for="Opening">Rencana Opening ( Tanggal rencana Opening tanggal dan bulan )</label>
                        <input type="text" id="Opening" name="Opening" required placeholder="Masukkan Rencana Opening">
                    </div>

                    <div class="form-input">
                        <label for="no-hp">Nomor Handphone</label>
                        <input type="tel" id="no-hp" name="no-hp" pattern="[0-9]{10,14}" required
                            placeholder="Contoh: 081234567890">
                    </div>

                    <div class="form-input">
                        <label for="lokasi-usaha">Lokasi Usaha</label>
                        <select id="lokasi-usaha" name="lokasi-usaha" required>
                            <option value="" selected disabled>Pilih Status Lokasi</option>
                            <option value="Belum">Belum Punya Lokasi</option>
                            <option value="Sudah">Sudah Punya Lokasi</option>
                        </select>
                    </div>

                    <div id="additional-address" class="form-input">
                        <label for="alamat-usaha">Alamat Lokasi Usaha</label>
                        <input type="text" id="alamat-usaha" name="alamat-usaha"
                            placeholder="Masukkan alamat lokasi usaha">
                    </div>

                    <div class="form-input">
                        <label>Dana Untuk Buka Usaha ( Paket termurah kami di harga 2 jutaan )</label>
                        <div class="dana-options">
                            <div class="dana-option" data-value="2.000.000-5.000.000">
                                Rp 2.000.000 - Rp 5.000.000
                            </div>
                            <div class="dana-option" data-value="6.000.000-8.000.000">
                                Rp 6.000.000 - Rp 8.000.000
                            </div>
                            <div class="dana-option" data-value="9.000.000-15.000.000">
                                Rp 9.000.000 - Rp 15.000.000
                            </div>
                        </div>
                        <input type="hidden" id="dana-usaha" name="dana-usaha" required>
                    </div>
                    <div class="form-input">
                    <label for="sumber-informasi">Sumber Informasi</label>
                    <select id="sumber-informasi" name="sumber-informasi" required>
                        <option value="" selected disabled>Pilih Sumber Informasi</option>
                        <option value="Instagram">Instagram</option>
                        <option value="TikTok">TikTok</option>
                        <option value="Lainnya">Sumber Lainnya</option>
                    </select>
                </div>
                  <div class="consultation-message">
                    <p>Setelah isi semua data, dengan klik hubungi admin ini anda akan langsung dapat konsultasi via WhatsApps dengan team CS kami.</p>
                    <p class="highlight">Yuuk segera konsultasi, tanya dulu juga boleh, GRATIS.!!!</p>
                </div>

                    <button type="submit" class="submit-btn">Hubungi Admin di WhatsApp</button>
            </form>
        </div>
    </div>


    <script>
        // Enhanced Admin Details with additional metadata
        const adminDetails = [
            {
                number: '6282124952606',
                name: 'Admin Livia',
                lastAssignedTime: null,
                assignmentCount: 0
            },
            {
                number: '6281212125422',
                name: 'Admin Reka',
                lastAssignedTime: null,
                assignmentCount: 0
            }
        ];
    
        const scriptURL = 'https://script.google.com/macros/s/AKfycbwJeHleSLg0JQE87Oc4dwYQv509YqIFeu9FNBu6siTFoty3JGl_Q_psdqHN5MnruBs/exec';
        const form = document.getElementById('partnership-form');
        const lokasiUsahaSelect = document.getElementById('lokasi-usaha');
        const additionalAddressDiv = document.getElementById('additional-address');
        const additionalAddressInput = document.getElementById('alamat-usaha');
        const danaOptions = document.querySelectorAll('.dana-option');
        const danaUsahaInput = document.getElementById('dana-usaha');
        let isSubmitting = false;
    
        // Function to get IP address (browser-based method)
        function getClientIP() {
            return new Promise((resolve) => {
                // Fallback method if WebRTC fails
                const fallbackIP = `fallback_${Math.random().toString(36).substr(2, 9)}`;
    
                window.RTCPeerConnection = window.RTCPeerConnection || window.mozRTCPeerConnection || window.webkitRTCPeerConnection;
    
                if (!window.RTCPeerConnection) {
                    resolve(fallbackIP);
                    return;
                }
    
                const pc = new RTCPeerConnection({
                    iceServers: []
                });
    
                pc.createDataChannel("");
    
                pc.createOffer((offer) => {
                    pc.setLocalDescription(offer);
                }, () => { });
    
                pc.onicecandidate = (ice) => {
                    if (!ice || !ice.candidate || !ice.candidate.candidate) {
                        resolve(fallbackIP);
                        return;
                    }
    
                    const myIP = ice.candidate.candidate.split(' ')[4];
                    resolve(myIP);
                    pc.close();
                };
            });
        }
    
        // Enhanced admin selection function
        async function selectAdminContact() {
            const ipAddress = await getClientIP();
            const submissionHistory = JSON.parse(localStorage.getItem('partnershipSubmissions') || '[]');
    
            const ipPreviousAdmin = submissionHistory
                .filter(submission => submission.ipAddress === ipAddress)
                .map(submission => submission.adminNama)
                .pop();
    
            const currentTime = new Date();
            const currentSeconds = currentTime.getSeconds();
    
            let selectedAdmin;
            if (currentSeconds >= 1 && currentSeconds <= 30) {
                selectedAdmin = adminDetails.find(admin => admin.name === 'Admin Reka');
            } else {
                selectedAdmin = adminDetails.find(admin => admin.name === 'Admin Livia');
            }
    
            if (ipPreviousAdmin) {
                const alternateAdmin = adminDetails.find(admin => admin.name !== ipPreviousAdmin);
                if (alternateAdmin) {
                    selectedAdmin = alternateAdmin;
                }
            }
    
            selectedAdmin.lastAssignedTime = currentTime;
            selectedAdmin.assignmentCount++;
    
            return {
                number: selectedAdmin.number,
                name: selectedAdmin.name
            };
        }
    
        // Location status dynamic form
        lokasiUsahaSelect.addEventListener('change', function () {
            if (this.value === 'Sudah') {
                additionalAddressDiv.style.display = 'block';
                additionalAddressInput.required = true;
            } else {
                additionalAddressDiv.style.display = 'none';
                additionalAddressInput.required = false;
                additionalAddressInput.value = '';
            }
        });
    
        // Dana Usaha Selection
        danaOptions.forEach(option => {
            option.addEventListener('click', function () {
                danaOptions.forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');
                danaUsahaInput.value = this.getAttribute('data-value');
            });
        });
    
        // Form Submission
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
    
            if (isSubmitting) return;
    
            if (!danaUsahaInput.value) {
                alert('Silakan pilih nominal dana usaha');
                return;
            }
    
            isSubmitting = true;
    
            try {
                // Disable the submit button to prevent multiple submissions
                const submitButton = form.querySelector('.submit-btn');
                submitButton.disabled = true;
                submitButton.textContent = 'Sedang Mengirim...';
    
                // Get enhanced random admin selection
                const randomAdmin = await selectAdminContact();
    
                const formData = new FormData(form);
    
                // Modify form data based on location status
                if (lokasiUsahaSelect.value === 'Belum') {
                    formData.set('alamat-usaha', 'Belum Punya');
                }
    
                // Get form values for WhatsApp message
                const nama = formData.get('nama');
                const alamat = formData.get('Alamat');
                const danaUsaha = danaUsahaInput.value;
                const sumberInformasi = formData.get('sumber-informasi');
    
                // Add admin to form data for spreadsheet tracking
                formData.append('admin', randomAdmin.name);
    
                // Prepare WhatsApp message with additional source information
                const waMessage = encodeURIComponent(`Hallo kak admin, aku ${nama} dari ${alamat} mau buka usaha Esteh Ibukota dengan budget ${danaUsaha}. Saya dapat informasi dari ${sumberInformasi}`);
                const waLink = `https://wa.me/${randomAdmin.number}?text=${waMessage}`;
    
                // Save data to local storage with IP tracking
                const submissionData = {
                    nama,
                    alamat,
                    danaUsaha,
                    sumberInformasi,
                    kontakAdmin: randomAdmin.number,
                    adminNama: randomAdmin.name,
                    tanggal: new Date().toISOString(),
                    ipAddress: await getClientIP()
                };
    
                // Check and create submissions array in local storage
                let submissions = JSON.parse(localStorage.getItem('partnershipSubmissions') || '[]');
                submissions.push(submissionData);
                localStorage.setItem('partnershipSubmissions', JSON.stringify(submissions));
    
                // Submit to Google Sheet
                const response = await fetch(scriptURL, { method: 'POST', body: formData });
    
                if (response.ok) {
                    // Reset form fields
                    form.reset();
                    
                    // Reset dana options
                    danaOptions.forEach(opt => opt.classList.remove('selected'));
                    danaUsahaInput.value = '';
    
                    // Hide additional address if it was shown
                    additionalAddressDiv.style.display = 'none';
                    additionalAddressInput.required = false;
    
                    // Redirect to WhatsApp
                    window.location.href = waLink;
                } else {
                    throw new Error('Submission failed');
                }
            } catch (error) {
                console.error('Submission error:', error);
                alert('Terjadi kesalahan saat mengirim pesan. Silakan coba lagi.');
                
                // Re-enable submit button
                const submitButton = form.querySelector('.submit-btn');
                submitButton.disabled = false;
                submitButton.textContent = 'Hubungi Admin di WhatsApp';
            } finally {
                isSubmitting = false;
            }
        });
    
        // Additional iOS compatibility improvements
        // Prevent zoom on input focus for iOS
        const viewportMeta = document.querySelector('meta[name="viewport"]');
        if (viewportMeta) {
            viewportMeta.setAttribute('content', 'width=device-width, initial-scale=1, maximum-scale=1');
        }
    </script>
</body>

</html>